@model ProcessLsystemResultModel

@{
	ViewBag.Title = "Malsys L-system processor";
	ViewBag.MainClass = "twoColumns";
}


<h2>L-system processor</h2>

@if (Model.SavedInputId != null) {
	string url = Request.Url.Scheme + System.Uri.SchemeDelimiter + Request.Url.Host +
		(Request.Url.IsDefaultPort ? "" : ":" + Request.Url.Port) + Url.Action(MVC.Process.Load(Model.SavedInputId));
	<p>
		Your input was saved under ID `@Model.SavedInputId`.
		You can share it by URL @Html.Link(url).
	</p>
}

@if (Model.NoProcessStatement) {
	<p class="errorBlock">
		No process statements found.
		Please look at the help to learn how to write process statements or use one from list below (put it at the very end of the input).
	</p>
	<ul>
		<li><code>process with SymbolPrinter;</code></li>
		<li><code>process with SvgRenderer;</code></li>
		<li><code>process with HexAsciiRenderer;</code></li>
		<li><code>process with ThreeJsRenderer;</code></li>
	</ul>
}

@if (Model.OutputFiles != null && Model.OutputFiles.Count > 0) {
	<p class="">
		Processing of input created @Model.OutputFiles.Count result(s) in @Math.Round(Model.ProcessDuration.TotalSeconds, 2) second(s).
		See them below.
	</p>
}

@if (Model.Logger != null && Model.Logger.Count > 0) {
	<table class="w100">
	<tr>
		<th style="width: 24px;"></th>
		<th>Message</th>
		<th style="width: 150px;">Position</th>
	</tr>
	@foreach (var msg in Model.Logger) {
	<tr class="@msg.Type.ToString().ToLower()">
		<td class="center"><abbr title="@msg.Type (@msg.Id)">@msg.Type.ToString()[0]</abbr></td>
		<td><p class="malsysMsg">@msg.MessageStr</p></td>
		<td>@(msg.Position.IsUnknown ? "" : msg.Position.ToString())</td>
	</tr>
 }
	</table>
	<hr />
}

<div class="floating_container clearfix">

<div class="floating_box">
@using (Html.BeginForm(MVC.Process.Index())) {
	<fieldset class="malsysSource">
		<legend>Source code</legend>

		@Html.ValidationSummary(true)

		@Html.TextAreaFor(m => m.SourceCode, 20, 60, null)

		@* @Html.HiddenFor(m => m.ReferenceId) inserts old value from POST instead of updated value from model *@
		<input id="ReferenceId" name="ReferenceId" type="hidden" value="@Model.ReferenceId" />

		<p>
			<input type="submit" name="Process" value="Process & display results" />
			<input type="submit" name="Compile" value="Try to compile" />
			<input type="submit" name="Save" value="Save & get permanent link" />
		</p>
	</fieldset>
}
</div>

@{
	bool loadThreeJs = false;
	if (Model.OutputFiles != null) {
		foreach (var result in Model.OutputFiles) {
			if (result.MimeType == Malsys.MimeType.Application.Json) {
				// TODO: this should be returned from partial view somehow
				// the condition is on two places => place for mistakes
				loadThreeJs = true;
			}
			<div class="floating_box">
			@Html.Partial("OutputPartial", result)
			</div>
		}
	}
}

</div>

@section scripts {
	@Content.Js(Links.Js.jquery_textarea_js)
	<script type="text/javascript">jQuery(document).ready(function () { $("#SourceCode").tabby() })</script>

	@if (loadThreeJs) {
		@Content.Js(Links.Js.ThreeJs.Three_js)
		@Content.Js(Links.Js.ThreeJs.Detector_js)
		@Content.Js(Links.Js.ThreeJs.threex_dragpancontrols_js)
		@Content.Js(Links.Js.ThreeJs.malsys_three_js)
	}
}